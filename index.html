<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOLEC ¬∑ Panel Propietario</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700&family=Barlow+Condensed:wght@500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f1117;
    --surface: #1a1d27;
    --surface2: #22263a;
    --surface3: #2a2f45;
    --rojo: #cc1a1a;
    --amarillo: #f5c800;
    --verde: #1a9a4a;
    --azul: #2a6adb;
    --naranja: #e07020;
    --border: #2e3248;
    --text: #e8eaf0;
    --text2: #7a8099;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: 'Barlow', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  /* TOPBAR */
  .topbar {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .topbar-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 24px;
  }

  .logo { display: flex; align-items: center; gap: 12px; }

  .logo-mark {
    width: 40px; height: 40px;
    background: var(--rojo);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    box-shadow: 0 0 0 2px var(--amarillo);
  }

  .logo h1 {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 22px; font-weight: 800;
    color: white; letter-spacing: 0.08em;
  }

  .logo h1 span { color: var(--amarillo); }
  .logo p { font-size: 11px; color: var(--text2); letter-spacing: 0.1em; text-transform: uppercase; }

  .topbar-right { display: flex; align-items: center; gap: 12px; }

  .filter-select {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 8px 14px;
    font-family: 'Barlow', sans-serif;
    font-size: 13px; font-weight: 500;
    color: var(--text);
    cursor: pointer; outline: none;
  }

  .topbar-bar { height: 3px; background: linear-gradient(90deg, var(--rojo), var(--amarillo)); }

  /* LAYOUT */
  .content { padding: 22px 24px; display: flex; flex-direction: column; gap: 20px; }

  /* KPI GRID */
  .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; }

  .kpi {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 18px 20px;
    position: relative;
    overflow: hidden;
  }

  .kpi::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
  }

  .kpi.rojo::after { background: var(--rojo); }
  .kpi.amarillo::after { background: var(--amarillo); }
  .kpi.verde::after { background: var(--verde); }
  .kpi.azul::after { background: var(--azul); }
  .kpi.naranja::after { background: var(--naranja); }

  .kpi-label {
    font-size: 10px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.1em;
    color: var(--text2); margin-bottom: 8px;
    font-family: 'Barlow Condensed', sans-serif;
  }

  .kpi-value {
    font-size: 28px; font-weight: 700;
    font-family: 'Barlow Condensed', sans-serif;
    line-height: 1;
  }

  .kpi.rojo .kpi-value { color: var(--rojo); }
  .kpi.amarillo .kpi-value { color: var(--amarillo); }
  .kpi.verde .kpi-value { color: var(--verde); }
  .kpi.azul .kpi-value { color: var(--azul); }
  .kpi.naranja .kpi-value { color: var(--naranja); }

  .kpi-sub { font-size: 11px; color: var(--text2); margin-top: 6px; }
  .kpi-trend { font-size: 11px; margin-top: 4px; font-weight: 600; }
  .trend-up { color: var(--verde); }
  .trend-down { color: var(--rojo); }

  /* CARDS */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .card-header {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
  }

  .card-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 14px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.06em;
    color: var(--text2);
  }

  .card-body { padding: 18px 20px; }

  /* GRID 2 */
  .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .grid3 { display: grid; grid-template-columns: 2fr 1fr; gap: 16px; }

  /* BAR CHART */
  .bar-chart { display: flex; flex-direction: column; gap: 12px; }

  .bar-row { display: flex; align-items: center; gap: 10px; }
  .bar-label { font-size: 12px; color: var(--text2); width: 130px; flex-shrink: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .bar-track { flex: 1; height: 8px; background: var(--surface2); border-radius: 4px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 4px; transition: width 0.8s ease; }
  .bar-val { font-size: 12px; font-family: 'Barlow Condensed', sans-serif; font-weight: 700; color: var(--text); width: 70px; text-align: right; flex-shrink: 0; }

  /* SEMAFORO PREVENTIVOS */
  .prev-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 4px 0; }

  .prev-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 8px 12px;
    background: var(--surface2);
    border-radius: 8px;
    border: 1px solid var(--border);
  }

  .prev-nombre { font-size: 12px; font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 130px; }
  .prev-estado {
    font-size: 10px; font-weight: 700;
    font-family: 'Barlow Condensed', sans-serif;
    padding: 2px 8px; border-radius: 4px;
    text-transform: uppercase; letter-spacing: 0.04em;
    flex-shrink: 0;
  }

  .prev-ok { background: rgba(26,154,74,0.2); color: var(--verde); }
  .prev-pend { background: rgba(204,26,26,0.2); color: var(--rojo); }
  .prev-curso { background: rgba(245,200,0,0.2); color: var(--amarillo); }

  /* MINI CHART SEMANAL */
  .week-chart { display: flex; align-items: flex-end; gap: 6px; height: 70px; }

  .week-bar {
    flex: 1; border-radius: 4px 4px 0 0;
    position: relative; cursor: pointer;
    transition: opacity 0.15s;
    min-height: 4px;
  }

  .week-bar:hover { opacity: 0.8; }

  .week-label {
    text-align: center;
    font-size: 10px; color: var(--text2);
    font-family: 'Barlow Condensed', sans-serif;
    margin-top: 6px;
  }

  .week-wrap { display: flex; flex-direction: column; }
  .week-cols { display: flex; gap: 6px; align-items: flex-end; height: 70px; }

  /* STOCK ALERT */
  .stock-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
  }

  .stock-item:last-child { border-bottom: none; }
  .stock-nombre { font-size: 13px; font-weight: 500; }
  .stock-detail { font-size: 11px; color: var(--text2); margin-top: 2px; }

  .stock-nivel {
    display: flex; flex-direction: column; align-items: flex-end; gap: 4px;
  }

  .stock-bar-track { width: 80px; height: 6px; background: var(--surface2); border-radius: 3px; overflow: hidden; }
  .stock-bar-fill { height: 100%; border-radius: 3px; }

  .stock-num { font-size: 11px; font-weight: 700; font-family: 'Barlow Condensed', sans-serif; }

  /* DESCUENTOS */
  .desc-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 9px 0; border-bottom: 1px solid var(--border);
    font-size: 13px;
  }

  .desc-item:last-child { border-bottom: none; }

  .desc-motivo { font-size: 11px; color: var(--text2); margin-top: 2px; font-style: italic; }

  .desc-monto { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; color: var(--rojo); font-size: 14px; }

  /* MARIO STATS */
  .mario-stat {
    display: flex; align-items: center; gap: 14px;
    padding: 10px 0; border-bottom: 1px solid var(--border);
  }

  .mario-stat:last-child { border-bottom: none; }

  .mario-icon {
    width: 36px; height: 36px;
    background: var(--surface2);
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px; flex-shrink: 0;
  }

  .mario-info { flex: 1; }
  .mario-label { font-size: 12px; color: var(--text2); }
  .mario-val { font-size: 18px; font-weight: 700; font-family: 'Barlow Condensed', sans-serif; }

  /* SOCIO TOGGLE */
  .socio-tabs {
    display: flex; gap: 6px; margin-bottom: 14px;
  }

  .socio-btn {
    padding: 6px 16px;
    border-radius: 6px;
    font-size: 12px; font-weight: 700;
    cursor: pointer; border: 1px solid var(--border);
    background: var(--surface2); color: var(--text2);
    font-family: 'Barlow Condensed', sans-serif;
    letter-spacing: 0.04em; text-transform: uppercase;
    transition: all 0.15s;
  }

  .socio-btn.active { background: var(--amarillo); color: var(--bg); border-color: var(--amarillo); }

  /* TOTALES SOCIOS */
  .socio-split {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 10px; margin-top: 14px;
  }

  .socio-card {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
  }

  .socio-card h4 {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 13px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.06em;
    color: var(--text2); margin-bottom: 10px;
  }

  .socio-row { display: flex; justify-content: space-between; font-size: 12px; padding: 4px 0; border-bottom: 1px solid var(--border); }
  .socio-row:last-child { border-bottom: none; font-weight: 700; font-size: 13px; color: var(--amarillo); }

  @media (max-width: 900px) {
    .kpi-grid { grid-template-columns: 1fr 1fr; }
    .grid2, .grid3 { grid-template-columns: 1fr; }
    .prev-grid { grid-template-columns: 1fr; }
  }
  .aprobar-card { background:var(--surface); border:1px solid var(--border); border-left:3px solid var(--rojo); border-radius:10px; padding:16px 20px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center; gap:16px; }
  .aprobar-title { font-size:16px; font-weight:600; margin-bottom:4px; }
  .aprobar-sub { font-size:12px; color:#888; margin-top:3px; }
  .btn-ap { padding:8px 18px; border-radius:8px; border:none; background:#2a9d8f; color:#fff; font-size:13px; font-weight:600; cursor:pointer; }
  .btn-rech { padding:8px 18px; border-radius:8px; border:1px solid #e63946; background:transparent; color:#e63946; font-size:13px; cursor:pointer; }
  .nota-overlay { position:fixed; inset:0; background:#000b; z-index:300; display:flex; align-items:center; justify-content:center; }
  .nota-overlay.hidden { display:none; }
  .nota-inner { background:#151820; border:1px solid #252a3a; border-radius:12px; padding:24px; width:420px; }
  .nota-inner h3 { margin-bottom:12px; }
  .nota-ta { width:100%; height:100px; background:#0d0f14; border:1px solid #252a3a; border-radius:8px; color:#e8eaf0; font-size:13px; padding:10px; resize:none; font-family:inherit; outline:none; margin-bottom:12px; }
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="topbar-inner">
    <div class="logo">
      <div class="logo-mark">‚ö°</div>
      <div>
        <h1>SOL<span>EC</span>¬Æ</h1>
        <p>Dashboard ¬∑ Propietario</p>
      </div>
    </div>
    <div class="topbar-right">
      <select class="filter-select" onchange="cambiarMes(this)">
        <option>Febrero 2026</option>
        <option>Enero 2026</option>
        <option>Diciembre 2025</option>
      </select>
      <select class="filter-select">
        <option>Todas las administraciones</option>
        <option>Ram√≠rez Fuentes</option>
      </select>
    </div>
  </div>
  <div class="topbar-bar"></div>
</div>

<div class="content">

  <!-- PARA APROBAR -->
  <div id="seccion-aprobar" style="margin-bottom:28px">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
      <div style="font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:700;letter-spacing:1px">
        PARA APROBAR <span id="badge-aprobar" style="background:var(--rojo);color:#fff;font-size:13px;padding:3px 10px;border-radius:10px;margin-left:8px;vertical-align:middle">0</span>
      </div>
    </div>
    <div id="lista-aprobar"><div style="color:#888;font-size:14px;padding:20px;background:var(--surface);border-radius:10px;border:1px solid var(--border);text-align:center">Sin registros pendientes</div></div>
  </div>

  <!-- KPIs -->
  <div class="kpi-grid">
    <div class="kpi verde">
      <div class="kpi-label">Facturado confirmado</div>
      <div class="kpi-value" id="kpi-facturado">$0</div>
      <div class="kpi-sub"><span id="kpi-sub-confirmados">0</span> registros confirmados</div>
      <div class="kpi-trend trend-up">‚Üë 18% vs enero</div>
    </div>
    <div class="kpi amarillo">
      <div class="kpi-label">Por facturar</div>
      <div class="kpi-value" id="kpi-porfacturar">$0</div>
      <div class="kpi-sub"><span id="kpi-sub-pendientes">0</span> registros pendientes</div>
      <div class="kpi-trend" style="color:var(--text2)">Esperando confirmaci√≥n</div>
    </div>
    <div class="kpi naranja">
      <div class="kpi-label">Materiales usados</div>
      <div class="kpi-value" id="kpi-materiales">$0</div>
      <div class="kpi-sub">38 registros ¬∑ 142 √≠tems</div>
      <div class="kpi-trend trend-down">‚Üì 5% vs enero</div>
    </div>
    <div class="kpi azul">
      <div class="kpi-label">Horas Mario</div>
      <div class="kpi-value" id="kpi-horas">0h</div>
      <div class="kpi-sub">38 visitas ¬∑ prom 4.4h</div>
      <div class="kpi-trend trend-up">‚Üë 12% vs enero</div>
    </div>
  </div>

  <!-- FILA 2: MANO DE OBRA + SEMANA -->
  <div class="grid3">

    <div class="card">
      <div class="card-header">
        <div class="card-title">Mano de obra por edificio</div>
        <div style="font-size:11px;color:var(--text2)">Top 8 ¬∑ Feb 2026</div>
      </div>
      <div class="card-body">
        <div class="bar-chart" id="bar-chart-edificios"><div style="color:#888;padding:20px;text-align:center">Sin registros a√∫n</div></div>
      </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:16px">

      <div class="card">
        <div class="card-header">
          <div class="card-title">Por semana</div>
        </div>
        <div class="card-body">
          <div style="display:flex;gap:8px;align-items:flex-end;height:80px;margin-bottom:6px">
            <div style="display:flex;flex-direction:column;align-items:center;flex:1">
              <div style="width:100%;background:var(--rojo);border-radius:4px 4px 0 0;height:40%;opacity:0.6"></div>
              <div style="font-size:10px;color:var(--text2);margin-top:4px;font-family:'Barlow Condensed',sans-serif">S1</div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:center;flex:1">
              <div style="width:100%;background:var(--rojo);border-radius:4px 4px 0 0;height:62%;opacity:0.75"></div>
              <div style="font-size:10px;color:var(--text2);margin-top:4px;font-family:'Barlow Condensed',sans-serif">S2</div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:center;flex:1">
              <div style="width:100%;background:var(--rojo);border-radius:4px 4px 0 0;height:100%"></div>
              <div style="font-size:10px;color:var(--text2);margin-top:4px;font-family:'Barlow Condensed',sans-serif">S3</div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:center;flex:1">
              <div style="width:100%;background:var(--surface3);border-radius:4px 4px 0 0;height:28%"></div>
              <div style="font-size:10px;color:var(--text2);margin-top:4px;font-family:'Barlow Condensed',sans-serif">S4</div>
            </div>
          </div>
          <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--text2)">
            <span>$187k</span><span>$291k</span><span>$364k</span><span style="color:var(--text2)">en curso</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header"><div class="card-title">Mario este mes</div></div>
        <div class="card-body">
          <div class="mario-stat">
            <div class="mario-icon">üè¢</div>
            <div class="mario-info">
              <div class="mario-label">Edificios visitados</div>
              <div class="mario-val">28 <span style="font-size:13px;color:var(--text2)">de 95</span></div>
            </div>
          </div>
          <div class="mario-stat">
            <div class="mario-icon">‚è±Ô∏è</div>
            <div class="mario-info">
              <div class="mario-label">Horas trabajadas</div>
              <div class="mario-val"><span id="stat-horas-total">0</span>h</div>
            </div>
          </div>
          <div class="mario-stat">
            <div class="mario-icon">üìã</div>
            <div class="mario-info">
              <div class="mario-label">Preventivos completados</div>
              <div class="mario-val">14 <span style="font-size:13px;color:var(--rojo)">/ 24</span></div>
            </div>
          </div>
          <div class="mario-stat">
            <div class="mario-icon">üö®</div>
            <div class="mario-info">
              <div class="mario-label">Urgencias atendidas</div>
              <div class="mario-val">3</div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- FILA 3: PREVENTIVOS + STOCK + DESCUENTOS -->
  <div class="grid2">

    <div class="card">
      <div class="card-header">
        <div class="card-title">Preventivos ‚Äî Feb 2026</div>
        <div style="display:flex;gap:8px;font-size:11px;font-weight:700">
          <span style="color:var(--verde)">‚óè 14 OK</span>
          <span style="color:var(--amarillo)">‚óè 2 en curso</span>
          <span style="color:var(--rojo)">‚óè 8 pendientes</span>
        </div>
      </div>
      <div class="card-body" style="max-height:280px;overflow-y:auto">
        <div class="prev-grid" id="prev-grid"></div>
      </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:16px">

      <div class="card">
        <div class="card-header">
          <div class="card-title">‚ö† Stock bajo</div>
          <div style="font-size:11px;color:var(--text2)">Camioneta + dep√≥sito</div>
        </div>
        <div class="card-body">
          <div class="stock-item">
            <div>
              <div class="stock-nombre">L√°mpara LED 9W fr√≠a</div>
              <div class="stock-detail">Camioneta: 3 ¬∑ Dep√≥sito: 2</div>
            </div>
            <div class="stock-nivel">
              <div class="stock-bar-track"><div class="stock-bar-fill" style="width:25%;background:var(--rojo)"></div></div>
              <div class="stock-num" style="color:var(--rojo)">5 u</div>
            </div>
          </div>
          <div class="stock-item">
            <div>
              <div class="stock-nombre">T√©rmica 20A bipolar</div>
              <div class="stock-detail">Camioneta: 1 ¬∑ Dep√≥sito: 0</div>
            </div>
            <div class="stock-nivel">
              <div class="stock-bar-track"><div class="stock-bar-fill" style="width:10%;background:var(--rojo)"></div></div>
              <div class="stock-num" style="color:var(--rojo)">1 u</div>
            </div>
          </div>
          <div class="stock-item">
            <div>
              <div class="stock-nombre">Pulsador luminoso</div>
              <div class="stock-detail">Camioneta: 4 ¬∑ Dep√≥sito: 8</div>
            </div>
            <div class="stock-nivel">
              <div class="stock-bar-track"><div class="stock-bar-fill" style="width:48%;background:var(--amarillo)"></div></div>
              <div class="stock-num" style="color:var(--amarillo)">12 u</div>
            </div>
          </div>
          <div class="stock-item">
            <div>
              <div class="stock-nombre">Cable unipolar 4mm</div>
              <div class="stock-detail">Camioneta: 8m ¬∑ Dep√≥sito: 15m</div>
            </div>
            <div class="stock-nivel">
              <div class="stock-bar-track"><div class="stock-bar-fill" style="width:38%;background:var(--amarillo)"></div></div>
              <div class="stock-num" style="color:var(--amarillo)">23 m</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Descuentos aplicados</div>
          <div style="font-size:11px;color:var(--rojo);font-weight:700">Total: $47.200</div>
        </div>
        <div class="card-body">
          <div class="desc-item">
            <div>
              <div style="font-weight:600">Monumental ¬∑ Service</div>
              <div class="desc-motivo">Cliente amigo, 20% desc.</div>
            </div>
            <div class="desc-monto">-$12.400</div>
          </div>
          <div class="desc-item">
            <div>
              <div style="font-weight:600">Nobile ¬∑ Service</div>
              <div class="desc-motivo">Edificio chico, 30% desc.</div>
            </div>
            <div class="desc-monto">-$18.600</div>
          </div>
          <div class="desc-item">
            <div>
              <div style="font-weight:600">Argos I ¬∑ Preventivo</div>
              <div class="desc-motivo">Abono 50% MO</div>
            </div>
            <div class="desc-monto">-$16.200</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- FILA 4: DIVISI√ìN SOCIOS -->
  <div class="card">
    <div class="card-header">
      <div class="card-title">Divisi√≥n interna ¬∑ Ram√≠rez vs Fuente</div>
      <div style="font-size:11px;color:var(--text2)">Solo visible para vos</div>
    </div>
    <div class="card-body">
      <div class="socio-split">
        <div class="socio-card">
          <h4>üìÅ Ram√≠rez ‚Äî 57 edificios</h4>
          <div class="socio-row"><span>Mano de obra</span><span>$487.000</span></div>
          <div class="socio-row"><span>Materiales</span><span>$108.000</span></div>
          <div class="socio-row"><span>Descuentos</span><span style="color:var(--rojo)">-$28.400</span></div>
          <div class="socio-row"><span>Preventivos</span><span>9/14 completos</span></div>
          <div class="socio-row"><span>TOTAL NETO</span><span>$566.600</span></div>
        </div>
        <div class="socio-card">
          <h4>üìÅ Fuente ‚Äî 38 edificios</h4>
          <div class="socio-row"><span>Mano de obra</span><span>$355.000</span></div>
          <div class="socio-row"><span>Materiales</span><span>$79.000</span></div>
          <div class="socio-row"><span>Descuentos</span><span style="color:var(--rojo)">-$18.800</span></div>
          <div class="socio-row"><span>Preventivos</span><span>5/10 completos</span></div>
          <div class="socio-row"><span>TOTAL NETO</span><span>$415.200</span></div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
const preventivos = [
  {nombre:"Iridio III", estado:"ok"},
  {nombre:"Santa Maria", estado:"ok"},
  {nombre:"Ameztoy", estado:"pendiente"},
  {nombre:"Torre del Centro", estado:"ok"},
  {nombre:"Torre del Sol", estado:"pendiente"},
  {nombre:"Calamayor", estado:"ok"},
  {nombre:"Ancla", estado:"ok"},
  {nombre:"Palacio √Årabe", estado:"curso"},
  {nombre:"Olazabal 2556", estado:"ok"},
  {nombre:"Gulfi VIII", estado:"ok"},
  {nombre:"Catedral", estado:"pendiente"},
  {nombre:"Marino V", estado:"ok"},
  {nombre:"Saavedra 65", estado:"pendiente"},
  {nombre:"Pigeon", estado:"ok"},
  {nombre:"Torre Gulfi I", estado:"ok"},
  {nombre:"Akros I", estado:"pendiente"},
  {nombre:"Atenas VIII", estado:"curso"},
  {nombre:"Sat√©lite", estado:"ok"},
  {nombre:"Atenas IX", estado:"pendiente"},
  {nombre:"Aruba", estado:"ok"},
  {nombre:"El Pato", estado:"pendiente"},
  {nombre:"Palacio Santiago", estado:"ok"},
  {nombre:"Bella Vista X", estado:"ok"},
  {nombre:"Cronos", estado:"pendiente"},
];

const labels = {ok:"‚úì Listo", pendiente:"‚úó Pendiente", curso:"‚è≥ En curso"};
const clases = {ok:"prev-ok", pendiente:"prev-pend", curso:"prev-curso"};

document.getElementById('prev-grid').innerHTML = preventivos.map(p => `
  <div class="prev-item">
    <div class="prev-nombre">${p.nombre}</div>
    <div class="prev-estado ${clases[p.estado]}">${labels[p.estado]}</div>
  </div>`).join('');

function cambiarMes(sel) {
  // En versi√≥n conectada al Sheet actualiza todos los datos
}

async function cargarDashboard() {
  try {
    const res = await fetch('https://sheetdb.io/api/v1/pqo4oljkpi6dj?sheet=Registros');
    const data = await res.json();
    
    const total = data.length;
    const confirmados = data.filter(r => r['Estado'] === 'confirmado').length;
    const pendientes = data.filter(r => r['Estado'] === 'Pendiente' || r['Estado'] === 'pendiente').length;
    
    if(document.getElementById('kpi-facturado')) document.getElementById('kpi-facturado').textContent = '$0';
    if(document.getElementById('kpi-porfacturar')) document.getElementById('kpi-porfacturar').textContent = '$0';
    if(document.getElementById('kpi-materiales')) document.getElementById('kpi-materiales').textContent = '$0';
    if(document.getElementById('kpi-horas')) document.getElementById('kpi-horas').textContent = '0h';
    if(document.getElementById('kpi-sub-confirmados')) document.getElementById('kpi-sub-confirmados').textContent = confirmados;
    if(document.getElementById('kpi-sub-pendientes')) document.getElementById('kpi-sub-pendientes').textContent = pendientes;
    
    // Edificios visitados
    const edificiosUnicos = [...new Set(data.map(r => r['Edificio']).filter(Boolean))];
    if(document.getElementById('stat-visitados')) document.getElementById('stat-visitados').textContent = edificiosUnicos.length;
    
    // Bar chart por edificio
    const conteo = {};
    data.forEach(r => { if(r['Edificio']) conteo[r['Edificio']] = (conteo[r['Edificio']] || 0) + 1; });
    const top = Object.entries(conteo).sort((a,b) => b[1]-a[1]).slice(0, 8);
    const maxVal = top.length > 0 ? top[0][1] : 1;
    const barHtml = top.length > 0 ? top.map(([edif, cant]) => 
      `<div class="bar-row">
        <div class="bar-label">${edif}</div>
        <div class="bar-track"><div class="bar-fill" style="width:${Math.round(cant/maxVal*100)}%;background:var(--rojo)"></div></div>
        <div class="bar-val">${cant} visitas</div>
      </div>`).join('') : '<div style="color:#888;padding:20px;text-align:center">Sin registros a√∫n</div>';
    if(document.getElementById('bar-chart-edificios')) document.getElementById('bar-chart-edificios').innerHTML = barHtml;
    
  } catch(err) {
    console.error('Error cargando dashboard:', err);
  }
}

cargarDashboard();
cargarParaAprobar();

async function cargarParaAprobar() {
  try {
    var res = await fetch("https://sheetdb.io/api/v1/pqo4oljkpi6dj?sheet=Registros");
    var data = await res.json();
    var enviados = data.filter(function(r){ return r["Estado"] === "Enviado"; });
    enviadosCache = enviados;
    document.getElementById("badge-aprobar").textContent = enviados.length;
    if (enviados.length === 0) {
      document.getElementById("lista-aprobar").innerHTML = '<div style="color:#888;font-size:14px;padding:20px;background:var(--surface);border-radius:10px;border:1px solid var(--border);text-align:center">Sin registros pendientes de aprobacion</div>';
      return;
    }
    var html = "";
    for (var i = 0; i < enviados.length; i++) {
      var r = enviados[i];
      var trab = [r["Trabajos Estructurados"], r["Trabajos Libres"]].filter(Boolean).join(" ¬∑ ");
      var mat = [r["Materiales Estructurados"], r["Materiales Libres"]].filter(Boolean).join(" ¬∑ ");
      var rid = (r["ID"] || "");
      var edif = (r["Edificio"] || "");
      html += '<div class="aprobar-card">';
      html += '<div style="flex:1">';
      html += '<div class="aprobar-title">' + edif + '</div>';
      html += '<div class="aprobar-sub">' + (r["Fecha"]||"") + " ¬∑ " + (r["Tipo de Visita"]||"") + " ¬∑ " + (r["Hora Inicio"]||"") + " ‚Üí " + (r["Hora Fin"]||"") + '</div>';
      if (trab) html += '<div class="aprobar-sub" style="margin-top:4px">üîß ' + trab + '</div>';
      if (mat) html += '<div class="aprobar-sub">üì¶ ' + mat + '</div>';
      html += '</div>';
      html += '<div style="display:flex;gap:8px;align-items:center">';
      html += '<button class="btn-ver-dueno" onclick="verDetalle(' + i + ')">Ver detalle</button>';
      html += '<button class="btn-rech" onclick="abrirNota('' + rid + '','' + edif.replace(/'/g,"") + '')">Con nota</button>';
      html += '<button class="btn-ap" onclick="aprobar('' + rid + '','' + edif.replace(/'/g,"") + '')">‚úÖ Aprobar</button>';
      html += '</div>';
      html += '</div>';
    }
    document.getElementById("lista-aprobar").innerHTML = html;
  } catch(e) {
    console.error("Error:", e);
    document.getElementById("lista-aprobar").innerHTML = '<div style="color:#e63946;padding:20px">Error: ' + e.message + '</div>';
  }
}


function verDetalle(idx) {
  var r = enviadosCache[idx];
  if (!r) return;
  document.getElementById("detalle-titulo").textContent = r["Edificio"] || "Registro";
  var html = "";
  html += "<div class=\"detalle-row\"><span class=\"detalle-label\">Fecha</span><span class=\"detalle-val\">" + (r["Fecha"]||"‚Äî") + "</span></div>";
  html += "<div class=\"detalle-row\"><span class=\"detalle-label\">Tipo de visita</span><span class=\"detalle-val\">" + (r["Tipo de Visita"]||"‚Äî") + "</span></div>";
  html += "<div class=\"detalle-row\"><span class=\"detalle-label\">Horario</span><span class=\"detalle-val\">" + (r["Hora Inicio"]||"") + " ‚Üí " + (r["Hora Fin"]||"") + "</span></div>";
  if (r["Trabajos Estructurados"]) html += "<div class=\"detalle-row\"><span class=\"detalle-label\">Trabajos</span><span class=\"detalle-val\">" + r["Trabajos Estructurados"] + "</span></div>";
  if (r["Trabajos Libres"]) html += "<div class=\"detalle-row\"><span class=\"detalle-label\">Trabajos libres</span><span class=\"detalle-val\">" + r["Trabajos Libres"] + "</span></div>";
  if (r["Materiales Estructurados"]) html += "<div class=\"detalle-row\"><span class=\"detalle-label\">Materiales</span><span class=\"detalle-val\">" + r["Materiales Estructurados"] + "</span></div>";
  if (r["Materiales Libres"]) html += "<div class=\"detalle-row\"><span class=\"detalle-label\">Materiales libres</span><span class=\"detalle-val\">" + r["Materiales Libres"] + "</span></div>";
  if (r["Descuento Abono"] === "S√≠") html += "<div class=\"detalle-row\"><span class=\"detalle-label\">Descuento abono</span><span class=\"detalle-val\" style=\"color:#2a9d8f\">S√≠ - 50%</span></div>";
  if (r["Urgencia Fuera Horario"] === "S√≠") html += "<div class=\"detalle-row\"><span class=\"detalle-label\">Urgencia fuera horario</span><span class=\"detalle-val\" style=\"color:#e63946\">S√≠</span></div>";
  if (r["Horas Extra"]) html += "<div class=\"detalle-row\"><span class=\"detalle-label\">Horas extra</span><span class=\"detalle-val\">" + r["Horas Extra"] + "h</span></div>";
  document.getElementById("detalle-contenido").innerHTML = html;
  document.getElementById("detalle-overlay").classList.remove("hidden");
}

async function confirmarRechazo() {
  var nota = document.getElementById("nota-ta").value.trim();
  if (!nota) { alert("Escribi una nota primero."); return; }
  try {
    await fetch("https://sheetdb.io/api/v1/pqo4oljkpi6dj/ID/" + regRechazar.sheetId + "?sheet=Registros", {
      method: "PATCH",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({data:{Estado:"Pendiente","Nota Dueno":nota}})
    });
    alert("Devuelto a Ciro con tu nota.");
    document.getElementById("nota-overlay").classList.add("hidden");
    cargarParaAprobar();
  } catch(e) { alert("Error."); }
}
</script>


<div class="detalle-overlay hidden" id="detalle-overlay">
  <div class="detalle-box">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
      <h3 id="detalle-titulo">Detalle</h3>
      <button onclick="document.getElementById('detalle-overlay').classList.add('hidden')" style="background:none;border:none;color:#888;font-size:18px;cursor:pointer">‚úï</button>
    </div>
    <div id="detalle-contenido"></div>
  </div>
</div>

<div class="nota-overlay hidden" id="nota-overlay">
  <div class="nota-inner">
    <h3>Devolver a Ciro con nota</h3>
    <textarea class="nota-ta" id="nota-ta" placeholder="Escribi que falta o que hay que cambiar..."></textarea>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button class="btn-rech" onclick="document.getElementById('nota-overlay').classList.add('hidden')">Cancelar</button>
      <button class="btn-ap" onclick="confirmarRechazo()">Enviar nota</button>
    </div>
  </div>
</div>
</body>
</html>
